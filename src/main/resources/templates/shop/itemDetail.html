<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">

<head>
  <title>상품 정보</title>
</head>

<th:block layout:fragment="css">
  <style>
    .mgb-15{
      margin-bottom:15px;
    }
    .mgt-30{
      margin-top:30px;
    }
    .mgt-50{
      margin-top:50px;
    }
    .itemMainImgDiv{
      margin-right:15px;
      height:auto;
      width:50%;
    }
    .itemMainImg{
      width:100%;
      height:400px;
    }
    .wd50{
      height:auto;
      width:50%;
    }
  </style>
</th:block>

<div layout:fragment="content" style="margin-left:25%;margin-right:25%">

  <div class="d-flex">
    <div class="itemMainImgDiv">
      <img th:src="|/view/s_${responseDTO.getMainImage().uuid}_${responseDTO.getMainImage().fileName}|" class="rounded itemMainImg"
           th:alt="${responseDTO.itemName}">
    </div>
    <div class="wd50">
      <span style="background-color: #0a53be" class="badge badge-primary mgb-15"
            th:if="${responseDTO.getSellingStatus() == T(com.example.cih.domain.shop.ItemSellingStatus).STATUS_SELLING}">
        판매중
      </span>
      <span style="background-color: red"  class="badge badge-primary mgb-15"
            th:if="${responseDTO.getSellingStatus() == T(com.example.cih.domain.shop.ItemSellingStatus).STATUS_SOLDOUT}">
        품절
      </span>

      <div class="h4" th:text="${responseDTO.itemName}"></div>
      <hr class="my-4">

      <div class="text-right">
        <div class="h4 text-danger text-left">
          <input type="hidden" th:value="${responseDTO.originalPrice}" class="originalPrice" id="price" name="price">
          <span th:text="${responseDTO.originalPrice}"></span>원
        </div>

        <div class="input-group w-50">
          <div class="input-group-prepend">
            <span class="input-group-text">수량</span>
          </div>
          <input type="number" name="itemCount" class="form-control itemCount" value="1" min="1">
        </div>

        <div class="input-group mb-3" th:with="optionDTO = ${responseDTO.listOptionType.get(0)}">
          <div class="input-group-prepend">
            <span class="input-group-text">옵션1</span>
            <input type="hidden" th:value="${optionDTO.getOptionType()}" class="itemOptionType1">
          </div>
          <select class= "form-control itemOptionValue1" >
            <option th:each="i, stat: ${#strings.arraySplit(optionDTO.getOptionValue() ,',')}"
                    th:value="${i}">[[${i}]]</option>
          </select>
        </div>

        <div class="input-group mb-3" th:with="optionDTO = ${responseDTO.listOptionType.get(1)}">
          <div class="input-group-prepend">
            <span class="input-group-text">옵션2</span>
            <input type="hidden" th:value="${optionDTO.getOptionType()}" class="itemOptionType2">
          </div>
          <select class= "form-control itemOptionValue2" >
            <option th:each="i, stat: ${#strings.arraySplit(optionDTO.getOptionValue() ,',')}"
                    th:value="${i}">[[${i}]]</option>
          </select>
        </div>
      </div>

      <hr class="my-4">

      <div class="text-right mgt-50">
        <h5>결제 금액</h5>
        <h3 name="totalPrice" id="totalPrice" class="font-weight-bold"></h3>
      </div>
      <div th:if="${responseDTO.getSellingStatus() == T(com.example.cih.domain.shop.ItemSellingStatus).STATUS_SELLING}"
           class="text-right">
        <button type="button" class="btn btn-primary addCartBtn">장바구니 담기</button>
        <button type="button" class="btn border-primary btn-lg">주문 하기</button>
      </div>
      <div th:unless="${responseDTO.getSellingStatus() == T(com.example.cih.domain.shop.ItemSellingStatus).STATUS_SELLING}"
           class="text-right">
        <button type="button" class="btn btn-danger btn-lg">품절</button>
      </div>
    </div>
  </div>

  <hr class="my-4">
  <hr class="my-4">
      <h4 class="display-5">상품 상세 설명</h4>
      <hr class="my-4">
      <p class="lead" th:text="${responseDTO.itemDesc}"></p>
  <hr class="my-4">
  <hr class="my-4">


  <div th:each="fileName : ${responseDTO.fileNames}" class="text-center">
    <img th:if="${not #strings.isEmpty(fileName.fileName)}"
            th:src="|/view/${fileName.uuid}_${fileName.fileName}|" class="rounded mgb-15" width="800">
  </div>



  <!--    axios 라이브러리 추가-->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="/js/cart.js"></script>

</div> <!--<div layout:fragment="content">-->

<script layout:fragment="script" th:inline="javascript">

  const shopItemId = [[${responseDTO.shopItemId}]]
  const itemName = [[${responseDTO.itemName}]]

  const itemCount = document.querySelector('.itemCount')
  const originalPrice = document.querySelector('.originalPrice')

  const itemOptionType1 = document.querySelector('.itemOptionType1');
  const itemOptionValue1 = document.querySelector('.itemOptionValue1');
  const itemOptionType2 = document.querySelector('.itemOptionType2');
  const itemOptionValue2 = document.querySelector('.itemOptionValue2');


  // 장바구니 담기
  document.querySelector(".addCartBtn").addEventListener("click", function(e){
    e.preventDefault()
    e.stopPropagation()


    const itemOptionList = []
    // if(itemOptionType1.value > 0 && itemOptionValue1.value.length > 0){
      itemOptionList.push({optionType:itemOptionType1.value, optionValue:itemOptionValue1.value})
    // }
    // if(itemOptionType2.value > 0 && itemOptionValue2.value.length > 0){
      itemOptionList.push({optionType:itemOptionType2.value, optionValue:itemOptionValue2.value})
   // }

    console.log(itemOptionList)

    let formObj = {
      shopItemId: shopItemId,
      itemName: itemName,
      itemCount: itemCount.value,
      itemPrice: originalPrice.value,
      itemOptionList:itemOptionList,
    }

    ////////////////////////////////////////////////////
    addCartItem(formObj).then(result => {
      //console.log(result)

      alert("정상적으로 장바구니에 담겼습니다")

      // 장바구니 페이지 로 이동
      self.location = '/cart/list'

    }).catch(e => {
      console.log(e)
    })
  }, false)




</script>