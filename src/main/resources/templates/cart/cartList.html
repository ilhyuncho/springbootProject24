<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">

<div layout:fragment="content">

    <div class="row mt-3">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <!--          HTML 테그의 속성이 아니라 HTML 콘텐츠 영역안에서 직접 데이터를 출력하고 싶으면 다음과 같이 [[...]] 를 사용하면 됩니다.-->
<!--                    [[${pageRequestDto.size}]]-->
                </div>
                <div class="card-body">
                    <h5 class="card-title">장바구니 List</h5>

                    <!--    댓글 처리 영역-->
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <ul class="list-group cartList">
                                <!-- 장바구니 리스트 영역-->
                            </ul>
                        </div>
                    </div>
                </div><!-- <div class="card-body">-->
            </div>
        </div>
    </div>

    <!--    axios 라이브러리 추가-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/js/cart.js"></script>
</div>




<script layout:fragment="script" th:inline="javascript">

    const currentUser = [[${#authentication.principal.username}]]
    const cartList = document.querySelector('.cartList')  // 댓글 목록 DOM

    // 비동기 처리
    // getList(currentUser) 호출시 Promise가 반환
    getList(currentUser).then(data => {
        //console.log(data)
        printList(data.dtoList) // 목록 처리
    }).catch(e=>{
        console.error(e)
    })

    function printList(dtoList){    // 목록 출력
        let str = '';

        if(dtoList && dtoList.length > 0){
            for(const dto of dtoList){
                str += `<li class="list-group-item d-flex replyItem">
                    <span class="col-2">${dto.cartId}</span>
                    <span class="col-2">${dto.shopItemId}</span>
                    <span class="col-2">${dto.itemName}</span>
                    <span class="col-2">${dto.itemCount}</span>
                    <span class="col-2" data-rno="${dto.shopItemId}">취소</span>
                    </li>`
            }
        }
        cartList.innerHTML = str
    }

    cartList.addEventListener("click", function(e){
        e.preventDefault()
        e.stopPropagation()

        const target = e.target

        if(!target || target.tagName !== 'SPAN'){
            return
        }

        const rno = target.getAttribute("data-rno")
        if(!rno){
            return
        }

        alert("항목 조회")

        // getReply(rno).then(reply => {
        //     console.log(reply)
        //     replyHeader.innerHTML = reply.rno
        //     modifyText.value = reply.replyText
        //
        //     modifyModal.show()
        //
        //     hasAuth = currentUser === reply.replyer     // 댓글의 작성자와 현재 사용자 일치 여부 확인
        //
        // }).catch(e => alert('error'))

    }, false)




    // clear 버튼 클릭 이벤트 begin ------------------
    // document.querySelector(".clearBtn").addEventListener("click", function(e){
    //
    //     console.log("clearBtn.click()~~~~")
    //
    //     e.preventDefault()
    //     e.stopPropagation()
    //
    //     self.location = '/dashBoard/carList'
    // },false)
    // clear 버튼 클릭 이벤트 end ------------------



</script>
